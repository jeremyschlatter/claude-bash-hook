# Claude Bash Hook Configuration
# Copy this file to ~/.config/claude-bash-hook/config.toml

# Default permission for commands not matching any rule
default = "ask"

# Rules are checked in order - first match wins
# More specific rules should come before general ones

# Read-only commands - always allow
[[rules]]
commands = [
    "ls", "cat", "head", "tail", "less", "more",
    "pwd", "whoami", "hostname", "uname", "id", "groups",
    "ps", "top", "htop", "df", "du", "free", "uptime", "date",
    "grep", "find", "wc", "sort", "uniq", "which", "whereis", "file",
    "jq", "yq", "xq",
    "cd", "echo", "mkdir", "cp", "mv",
    "sed", "awk",  # sed -i requires edit mode
]
permission = "allow"
reason = "read-only commands"

# Git read-only operations
[[rules]]
commands = [
    "git status", "git log", "git diff", "git branch",
    "git remote", "git show", "git rev-parse", "git describe",
]
permission = "allow"
reason = "git read-only"

# Git switch with force flag - ask
[[rules]]
commands = ["git switch -f", "git switch --force"]
permission = "ask"
reason = "force switch can discard changes"

# Git switch/restore without force - allow
[[rules]]
commands = ["git switch", "git restore"]
permission = "allow"
reason = "safe git operations"

# Docker read-only
[[rules]]
commands = ["docker ps", "docker logs", "docker inspect", "docker images"]
permission = "allow"
reason = "docker read-only"

# Docker destructive - ask
[[rules]]
commands = ["docker rm", "docker rmi", "docker system prune"]
permission = "ask"
reason = "docker destructive"

# Kubectl read-only
[[rules]]
commands = ["kubectl get", "kubectl describe", "kubectl logs"]
permission = "allow"
reason = "kubectl read-only"

# Recursive delete - deny
[[rules]]
commands = ["rm -rf", "rm -r", "rm --recursive"]
permission = "deny"
reason = "recursive delete"

# Single file delete - ask
[[rules]]
commands = ["rm"]
permission = "ask"
reason = "file deletion"

# Disk operations - deny
[[rules]]
commands = ["mkfs", "dd", "fdisk", "parted"]
permission = "deny"
reason = "disk operations"

# SSH with host rules
[[rules]]
commands = ["ssh", "scp", "rsync"]
permission = "check_host"
reason = "remote connection"
host_rules = [
    { pattern = "dev-*", permission = "allow" },
    { pattern = "staging-*", permission = "ask" },
    { pattern = "prod-*", permission = "ask" },
    { pattern = "*", permission = "allow" },
]

# Wrapper configurations - these commands are "unwrapped" to analyze the inner command
# Simple wrappers are config-driven (skip options, run inner command)
# Complex wrappers have special handling: ssh, scp, rsync, env, kubectl exec, timeout

[[wrappers]]
command = "sudo"
opts_with_args = ["-g", "-p", "-r", "-t", "-u", "-T", "-C", "-h", "-U"]

[[wrappers]]
command = "nice"
opts_with_args = ["-n"]

[[wrappers]]
command = "nohup"
opts_with_args = []

[[wrappers]]
command = "time"
opts_with_args = ["-o", "-f"]

[[wrappers]]
command = "strace"
opts_with_args = ["-e", "-o", "-p", "-s", "-u"]

[[wrappers]]
command = "ltrace"
opts_with_args = ["-e", "-o", "-p", "-s", "-u", "-n"]

# These have special handling (hardcoded) - listed here for documentation:
# - ssh: extracts host, inner command after host
# - scp: extracts host from user@host:path
# - rsync: extracts host from user@host:path
# - env: skips VAR=value, inner command after
# - kubectl exec: inner command after --
# - timeout: skips duration arg, inner command after

# Command suggestions
[[suggestions]]
command = "git checkout"
message = "Consider using 'git switch <branch>' or 'git restore <file>' instead"

[[suggestions]]
command = "docker-compose"
message = "Use 'docker compose' (v2) instead of 'docker-compose'"

[[suggestions]]
command = "find"
message = "Use the Glob tool or 'fd' for file search"

[[suggestions]]
command = "grep"
message = "Use the Grep tool instead of grep/rg"
